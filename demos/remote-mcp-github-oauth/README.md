# Remote MCP Server with GitHub Authentication

This project demos how to add authentication to an MCP ([Model Context Protocol](https://modelcontextprotocol.io/introduction)) server that's built on Cloudflare using GitHub login. This allows users to connect to your MCP server by signing in with their GitHub account.

The MCP server (powered by [Cloudflare Workers](https://developers.cloudflare.com/workers/)): 

* Acts as OAuth _Server_ to your MCP clients
* Acts as OAuth _Client_ to your _real_ OAuth server (in this case, GitHub)

## Getting Started

You'll need to create two [GitHub OAuth](https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/creating-an-oauth-app) applications:

- One for local development
- One for production deployment

### For local development
Create a new GitHub OAuth App:
- For the Homepage URL, specify `http://localhost:8788`
- For the Authorization callback URL, specify `http://localhost:8788/callback`
- Note your Client ID and generate a Client secret. 
- Create a `.dev.vars` file in your project root with: 
```
GITHUB_CLIENT_ID=your_development_github_client_id
GITHUB_CLIENT_SECRET=your_development_github_client_secret
```

### For production
Create another OAuth App:
- For the Homepage URL, specify `https://<your-worker-name>.workers.dev`
- For the Authorization callback URL, specify `https://<your-worker-name>.workers.dev/callback`
- Note your Client ID and generate a Client secret. 
- Set secrets via Wrangler
```bash
wrangler secret put GITHUB_CLIENT_ID
wrangler secret put GITHUB_CLIENT_SECRET
```
#### Set up a KV namespace
- For development: `wrangler kv:namespace create "OAUTH_KV"`
- For production: `wrangler kv:namespace create "OAUTH_KV" --env production`
- Update the Wrangler file to include the KV namespace ID

#### Deploy the MCP Server
- Run the server locally to make it available at http://localhost:8788

`wrangler dev`

- Deploy the MCP server to make it available on your workers.dev domain 

` wrangler deploy`

## Test the MCP server with the OAuth flow

#### Using Inspector

```
npx @modelcontextprotocol/inspector@latest
```

Enter `https://<your-worker-name>.workers.dev/sse` and hit connect. Follow the prompts, then see if the tool calls work:

<img width="640" alt="image" src="https://github.com/user-attachments/assets/7973f392-0a9d-4712-b679-6dd23f824287" />

#### Using Claude

Open Claude Desktop and navigate to Settings -> Developer -> Edit Config. This opens the configuration file that controls which MCP servers Claude can access.

Replace the content with this configuration: 
```
{
  "mcpServers": {
    "math": {
      "command": "npx",
      "args": [
        "mcp-remote",
        "https://<your-worker-name>.workers.dev/sse"
      ]
    }
  }
}
```

Save the file and restart Claude Desktop (command + R). When Claude restarts, a browser window will open showing your OAuth login page. Complete the authentication flow to grant Claude access to your MCP server. Once authenticated, you'll be able to see your tools by clicking the tools icon in the bottom right corner of Claude's interface.

Ask Claude to use one of your tools. For example: "Could you use the math tool to add 23 and 19?". Claude should invoke the tool and show the result generated by the MCP server.

#### Using Cursor and other MCP Clients

To connect Cursor with your MCP server, choose `Type`: "Command" and in the `Command` field, combine the command and args fields into one (e.g. `npx mcp-remote https://<your-worker-name>.workers.dev/sse`).

You can connect your MCP server to other MCP clients like Windsurf by opening the client's configuration file, adding the same JSON that was used for the Claude setup, and restarting the MCP client.

## How does it work? 

#### OAuth Provider
The OAuth Provider library serves as a complete OAuth 2.0 server implementation for Cloudflare Workers. It handles the complexities of the OAuth flow, including token issuance, validation, and management. It handles:

- Authenticating MCP clients that connect to your server
- Managing the connection to GitHub's OAuth services
- Securely storing tokens and authentication state in KV storage

#### Durable MCP
Durable MCP extends the base MCP functionality with Cloudflare's Durable Objects, providing:
- Persistent state management for your MCP server
- Secure storage of authentication context between requests
- Access to authenticated user information via `this.props`
- Support for conditional tool availability based on user identity

#### MCP Remote
The MCP Remote library enables your server to expose tools that can be invoked by MCP clients like the Inspector. It:
- Defines the protocol for communication between clients and your server
- Provides a structured way to define tools
- Handles serialization and deserialization of requests and responses
- Maintains the Server-Sent Events (SSE) connection between clients and your server